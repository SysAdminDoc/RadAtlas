<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="RadAtlas - Professional X-Ray Technique Reference by Maven Imaging">
  <meta name="author" content="Maven Imaging, LLC">
  <meta name="theme-color" content="#1e3a5f">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="RadAtlas">
  <title>RadAtlas - X-Ray Technique Reference | Maven Imaging</title>
  <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/SysAdminDoc/RadAtlas/refs/heads/main/images/MavenLogo.ico">
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/SysAdminDoc/RadAtlas/refs/heads/main/images/maven.png">
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/SysAdminDoc/RadAtlas/refs/heads/main/images/maven.png">
  <style>
    :root {
      --maven-navy: #1e3a5f;
      --maven-blue: #5ba4e6;
      --maven-light-blue: #7bb8eb;
      --maven-dark: #0a0f1a;
      --maven-darker: #060a12;
      --text-primary: #e2e8f0;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --border-color: #1e293b;
      --card-bg: #1e293b;
      --card-hover: #283548;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--maven-dark);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }
    body::before {
      content: '';
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 700px;
      height: 700px;
      background: url('https://raw.githubusercontent.com/SysAdminDoc/RadAtlas/refs/heads/main/images/MavenLogo.png') no-repeat center center;
      background-size: contain;
      opacity: 0.08;
      pointer-events: none;
      z-index: 0;
    }

    /* LICENSE GATE SCREEN */
    .license-gate {
      position: fixed;
      inset: 0;
      background: var(--maven-dark);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 20px;
    }
    .license-gate.hidden {
      display: none;
    }
    .license-box {
      background: var(--card-bg);
      border: 1px solid #334155;
      border-radius: 20px;
      padding: 48px;
      max-width: 440px;
      width: 100%;
      text-align: center;
    }
    .license-logo {
      width: 80px;
      height: 80px;
      margin-bottom: 24px;
    }
    .license-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--maven-blue);
      margin-bottom: 8px;
    }
    .license-subtitle {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 32px;
    }
    .license-form {
      text-align: left;
    }
    .license-form label {
      display: block;
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      font-weight: 500;
    }
    .license-form input {
      width: 100%;
      padding: 14px 16px;
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 15px;
      margin-bottom: 16px;
    }
    .license-form input:focus {
      outline: none;
      border-color: var(--maven-blue);
    }
    .license-form input::placeholder {
      color: var(--text-muted);
    }
    .license-btn {
      width: 100%;
      padding: 16px;
      background: var(--maven-blue);
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 16px;
    }
    .license-btn:hover {
      background: var(--maven-light-blue);
    }
    .license-btn:disabled {
      background: #475569;
      cursor: not-allowed;
    }
    .license-error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 8px;
      padding: 12px;
      font-size: 13px;
      color: #ef4444;
      margin-bottom: 16px;
      display: none;
    }
    .license-error.show {
      display: block;
    }
    .license-divider {
      display: flex;
      align-items: center;
      gap: 16px;
      margin: 24px 0;
      color: var(--text-muted);
      font-size: 13px;
    }
    .license-divider::before,
    .license-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: #334155;
    }
    .license-get-trial {
      display: block;
      width: 100%;
      padding: 14px;
      background: transparent;
      border: 1px solid #334155;
      border-radius: 10px;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      text-align: center;
    }
    .license-get-trial:hover {
      background: #1e293b;
      border-color: #475569;
      color: var(--text-primary);
    }
    .license-footer {
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid #334155;
    }
    .license-footer img {
      width: 100px;
      opacity: 0.6;
      margin-bottom: 8px;
    }
    .license-footer p {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* TRIAL BANNER */
    .trial-banner {
      background: linear-gradient(90deg, rgba(245,158,11,0.15) 0%, rgba(245,158,11,0.05) 100%);
      border-bottom: 1px solid rgba(245,158,11,0.3);
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      font-size: 13px;
    }
    .trial-banner.hidden {
      display: none;
    }
    .trial-banner .trial-text {
      color: #f59e0b;
    }
    .trial-banner .trial-days {
      font-weight: 600;
    }
    .trial-banner .trial-upgrade {
      padding: 6px 12px;
      background: #f59e0b;
      border: none;
      border-radius: 6px;
      color: #0f172a;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
    }
    .trial-banner .trial-upgrade:hover {
      background: #fbbf24;
    }

    /* SPLASH SCREEN */
    .splash-screen {
      position: fixed;
      inset: 0;
      background: var(--maven-dark);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9998;
      transition: opacity 0.5s, visibility 0.5s;
    }
    .splash-screen.hidden {
      opacity: 0;
      visibility: hidden;
    }
    .splash-logo {
      width: 120px;
      height: 120px;
      animation: pulse 1.5s ease-in-out infinite;
    }
    .splash-title {
      font-size: 32px;
      font-weight: 700;
      color: var(--maven-blue);
      margin-top: 20px;
      opacity: 0;
      animation: fadeIn 0.5s ease-out 0.3s forwards;
    }
    .splash-subtitle {
      font-size: 14px;
      color: var(--text-muted);
      margin-top: 8px;
      opacity: 0;
      animation: fadeIn 0.5s ease-out 0.5s forwards;
    }
    .splash-company {
      position: absolute;
      bottom: 40px;
      display: flex;
      align-items: center;
      gap: 10px;
      opacity: 0;
      animation: fadeIn 0.5s ease-out 0.7s forwards;
    }
    .splash-company img {
      width: 28px;
      height: 28px;
    }
    .splash-company span {
      font-size: 13px;
      color: var(--text-secondary);
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.8; }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* HEADER */
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(10, 15, 26, 0.98);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-color);
      padding: 10px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .header-brand {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 8px;
      transition: background 0.2s;
    }
    .header-brand:hover {
      background: rgba(91, 164, 230, 0.1);
    }
    .header-logo {
      width: 44px;
      height: 44px;
    }
    .header-titles {
      display: flex;
      flex-direction: column;
    }
    .header-main-title {
      font-size: 22px;
      font-weight: 700;
      color: var(--maven-blue);
      line-height: 1.2;
    }
    .header-tagline {
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .header-tagline .maven-text {
      color: var(--maven-light-blue);
      font-weight: 500;
    }
    .nav-tabs {
      display: flex;
      margin-left: auto;
      gap: 4px;
    }
    .nav-tab {
      padding: 8px 16px;
      background: transparent;
      border: none;
      border-radius: 8px;
      color: var(--text-muted);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .nav-tab:hover { background: var(--card-bg); color: var(--text-secondary); }
    .nav-tab.active { background: var(--maven-navy); color: white; }
    .nav-tab svg { width: 16px; height: 16px; }

    /* MAIN LAYOUT */
    .main-container {
      display: flex;
      min-height: calc(100vh - 65px);
      position: relative;
      z-index: 1;
    }
    
    /* ANATOMY PANEL */
    .anatomy-panel {
      width: 380px;
      min-width: 380px;
      background: linear-gradient(180deg, #0f172a 0%, var(--maven-dark) 100%);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      position: relative;
    }
    .anatomy-header {
      padding: 16px;
      border-bottom: 1px solid var(--border-color);
    }
    .anatomy-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    .anatomy-hint {
      font-size: 12px;
      color: var(--text-muted);
    }
    .selected-region-badge {
      display: inline-block;
      padding: 4px 10px;
      background: var(--maven-navy);
      border-radius: 12px;
      font-size: 11px;
      color: white;
      margin-top: 8px;
    }
    .anatomy-container {
      flex: 1;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 20px;
      position: relative;
      overflow-y: auto;
    }
    .anatomy-figure {
      position: relative;
      width: 100%;
      max-width: 320px;
    }
    .anatomy-figure img {
      width: 100%;
      height: auto;
      filter: drop-shadow(0 0 40px rgba(91, 164, 230, 0.15));
    }
    
    /* CLICKABLE HOTSPOTS */
    .hotspot {
      position: absolute;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
      border: 2px solid transparent;
    }
    .hotspot:hover {
      background: rgba(91, 164, 230, 0.25);
      border-color: rgba(91, 164, 230, 0.5);
    }
    .hotspot.active {
      background: rgba(91, 164, 230, 0.35);
      border-color: var(--maven-blue);
      box-shadow: 0 0 12px rgba(91, 164, 230, 0.4);
    }
    .hotspot-label {
      position: absolute;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid #334155;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
      z-index: 10;
    }
    .hotspot:hover .hotspot-label {
      opacity: 1;
    }
    
    /* TECHNIQUES PANEL */
    .techniques-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .controls {
      padding: 16px;
      border-bottom: 1px solid var(--border-color);
      background: rgba(15, 23, 42, 0.5);
    }
    .search-row {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    .search-box {
      flex: 1;
      padding: 12px 16px;
      background: var(--card-bg);
      border: 1px solid #334155;
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
    }
    .search-box:focus { outline: none; border-color: var(--maven-blue); }
    .search-box::placeholder { color: var(--text-muted); }
    .add-btn {
      padding: 12px 20px;
      background: #22c55e;
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }
    .add-btn:hover { background: #16a34a; }
    .add-btn svg { width: 18px; height: 18px; }
    .filter-row { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 8px; }
    .filter-btn {
      padding: 6px 14px;
      background: var(--card-bg);
      border: none;
      border-radius: 20px;
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .filter-btn:hover { background: #334155; }
    .filter-btn.active { background: var(--maven-navy); color: white; }
    .size-btn {
      padding: 6px 12px;
      background: var(--card-bg);
      border: 1px solid transparent;
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .size-btn.active {
      background: rgba(91, 164, 230, 0.2);
      border-color: rgba(91, 164, 230, 0.4);
      color: var(--maven-blue);
    }
    .stats-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
    }
    .stats { font-size: 12px; color: var(--text-muted); }
    .reset-btn {
      padding: 4px 10px;
      background: transparent;
      border: 1px solid #475569;
      border-radius: 6px;
      color: var(--text-secondary);
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .reset-btn:hover { background: #334155; border-color: var(--text-muted); }
    
    .grid-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 12px;
    }
    .card {
      background: var(--card-bg);
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    .card:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.3); background: var(--card-hover); }
    .card.favorited { border-color: rgba(245, 158, 11, 0.4); background: rgba(245, 158, 11, 0.05); }
    .card.custom { border-color: rgba(34, 197, 94, 0.4); }
    .card-actions {
      position: absolute;
      top: 12px;
      right: 12px;
      display: flex;
      gap: 4px;
    }
    .card-btn {
      width: 32px; height: 32px;
      background: #0f172a;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      transition: all 0.2s;
    }
    .card-btn:hover { color: var(--text-secondary); background: var(--card-bg); }
    .card-btn.fav-btn:hover { color: #f59e0b; }
    .card-btn.fav-btn.active { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
    .card-btn.edit-btn:hover { color: var(--maven-blue); }
    .card-btn.delete-btn:hover { color: #ef4444; }
    .card-btn svg { width: 16px; height: 16px; }
    .card-region { font-size: 10px; color: #06b6d4; text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; }
    .card-body { font-size: 16px; font-weight: 700; margin: 4px 0 2px; }
    .card-view { font-size: 14px; color: var(--text-secondary); }
    .card-values { display: flex; gap: 8px; margin: 12px 0; }
    .value-box {
      flex: 1;
      background: #0f172a;
      border-radius: 8px;
      padding: 8px;
      text-align: center;
    }
    .value-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; }
    .value-num { font-size: 20px; font-weight: 700; color: var(--maven-blue); font-family: monospace; }
    .card-meta { display: flex; gap: 16px; font-size: 11px; color: var(--text-muted); }
    .card-meta .grid-yes { color: #22c55e; }
    .custom-badge {
      display: inline-block;
      padding: 2px 6px;
      background: rgba(34, 197, 94, 0.2);
      border-radius: 4px;
      font-size: 9px;
      color: #22c55e;
      margin-left: 8px;
      text-transform: uppercase;
      font-weight: 600;
    }
    
    /* MODAL */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(4px);
      z-index: 200;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s;
    }
    .modal-overlay.open { opacity: 1; visibility: visible; }
    .modal {
      background: var(--card-bg);
      border: 1px solid #334155;
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 24px;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 16px;
    }
    .modal-close {
      background: #0f172a;
      border: none;
      width: 32px; height: 32px;
      border-radius: 8px;
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-close:hover { color: var(--text-primary); }
    .modal-region { font-size: 12px; color: #06b6d4; text-transform: uppercase; font-weight: 600; }
    .modal-title { font-size: 24px; font-weight: 700; margin: 4px 0; }
    .modal-view { font-size: 18px; color: var(--text-secondary); }
    .modal-values { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin: 20px 0; }
    .modal-value {
      background: #0f172a;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }
    .modal-value-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px; }
    .modal-value-num { font-size: 28px; font-weight: 700; color: var(--maven-blue); font-family: monospace; }
    .modal-section { margin-top: 20px; }
    .modal-section-title { font-size: 12px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px; }
    .modal-note { background: #0f172a; padding: 12px; border-radius: 8px; font-size: 14px; }
    .modal-sizes { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
    .modal-size-box {
      background: #0f172a;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
    }
    .modal-size-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; }
    .modal-size-value { font-size: 18px; font-weight: 700; color: var(--text-secondary); margin-top: 4px; }
    .modal-size-box.active .modal-size-value { color: var(--maven-blue); }
    .modal-actions {
      display: flex;
      gap: 8px;
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid #334155;
    }
    .modal-actions button {
      flex: 1;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-edit {
      background: var(--maven-navy);
      border: none;
      color: white;
    }
    .btn-edit:hover { background: #2a4a70; }
    .btn-delete {
      background: transparent;
      border: 1px solid #ef4444;
      color: #ef4444;
    }
    .btn-delete:hover { background: rgba(239, 68, 68, 0.1); }
    
    /* ABOUT MODAL */
    .about-modal {
      max-width: 420px;
      text-align: center;
    }
    .about-logo {
      width: 80px;
      height: 80px;
      margin: 0 auto 16px;
    }
    .about-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--maven-blue);
      margin-bottom: 4px;
    }
    .about-version {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 20px;
    }
    .about-divider {
      height: 1px;
      background: #334155;
      margin: 20px 0;
    }
    .about-company-logo {
      width: 160px;
      margin: 0 auto 12px;
    }
    .about-company-name {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    .about-website {
      font-size: 13px;
      color: var(--maven-blue);
      text-decoration: none;
    }
    .about-website:hover {
      text-decoration: underline;
    }
    .about-description {
      font-size: 13px;
      color: var(--text-muted);
      margin: 16px 0;
      line-height: 1.5;
    }
    .about-license {
      background: #0f172a;
      border-radius: 8px;
      padding: 12px;
      margin: 16px 0;
      font-size: 12px;
    }
    .about-license-label {
      color: var(--text-muted);
      margin-bottom: 4px;
    }
    .about-license-status {
      color: #22c55e;
      font-weight: 600;
    }
    .about-license-status.trial {
      color: #f59e0b;
    }
    .about-copyright {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 20px;
    }
    .about-logout {
      margin-top: 16px;
      padding: 10px 20px;
      background: transparent;
      border: 1px solid #475569;
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 13px;
      cursor: pointer;
    }
    .about-logout:hover {
      background: #1e293b;
    }
    
    /* EDIT MODAL */
    .edit-modal {
      max-width: 600px;
    }
    .edit-modal h2 {
      font-size: 20px;
      margin-bottom: 20px;
      color: var(--text-primary);
    }
    .form-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }
    .form-row.two-col {
      grid-template-columns: repeat(2, 1fr);
    }
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .form-group.full-width {
      grid-column: 1 / -1;
    }
    .form-group label {
      font-size: 12px;
      color: var(--text-secondary);
      font-weight: 500;
    }
    .form-group label span {
      color: #ef4444;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 10px 12px;
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 14px;
    }
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--maven-blue);
    }
    .form-group select {
      cursor: pointer;
    }
    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }
    .mas-table {
      background: #0f172a;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 16px;
    }
    .mas-table-header {
      display: grid;
      grid-template-columns: 1fr 1fr;
      padding: 10px 12px;
      background: var(--card-bg);
      font-size: 11px;
      text-transform: uppercase;
      color: var(--text-muted);
      font-weight: 600;
    }
    .mas-table-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      padding: 8px 12px;
      align-items: center;
      border-top: 1px solid var(--card-bg);
    }
    .mas-table-row span {
      font-size: 14px;
    }
    .mas-table-row input {
      padding: 8px;
      background: var(--card-bg);
      border: 1px solid #334155;
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 14px;
      text-align: center;
    }
    .mas-table-row input:focus {
      outline: none;
      border-color: var(--maven-blue);
    }
    .form-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid #334155;
    }
    .form-actions button {
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-cancel {
      background: transparent;
      border: 1px solid #475569;
      color: var(--text-secondary);
    }
    .btn-cancel:hover { background: #334155; }
    .btn-save {
      background: var(--maven-navy);
      border: none;
      color: white;
      margin-left: auto;
    }
    .btn-save:hover { background: #2a4a70; }
    
    /* FOOTER */
    .footer {
      background: var(--maven-darker);
      border-top: 1px solid var(--border-color);
      padding: 20px;
    }
    .footer-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 1200px;
      margin: 0 auto;
    }
    .footer-brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .footer-logo {
      width: 32px;
      height: 32px;
    }
    .footer-company {
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 500;
    }
    .footer-tagline {
      font-size: 11px;
      color: var(--text-muted);
    }
    .footer-center {
      text-align: center;
    }
    .footer-disclaimer {
      font-size: 11px;
      color: var(--text-muted);
    }
    .footer-version {
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 4px;
    }
    .footer-right {
      text-align: right;
    }
    .footer-copyright {
      font-size: 11px;
      color: var(--text-muted);
    }
    
    /* MOBILE RESPONSIVE */
    @media (max-width: 900px) {
      .main-container { flex-direction: column; }
      .anatomy-panel {
        width: 100%;
        min-width: 100%;
        max-height: 50vh;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
      }
      .anatomy-container { padding: 10px; }
      .anatomy-figure { max-width: 200px; }
      .nav-tab span { display: none; }
      .form-row { grid-template-columns: 1fr; }
      .form-row.two-col { grid-template-columns: 1fr; }
      .footer-content { flex-direction: column; gap: 16px; text-align: center; }
      .footer-right { text-align: center; }
      .header-tagline { display: none; }
      .trial-banner { flex-wrap: wrap; text-align: center; }
    }
    
    /* EMPTY STATE */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }
    .empty-state svg { width: 64px; height: 64px; opacity: 0.5; margin-bottom: 16px; }
    .empty-state h3 { font-size: 18px; color: var(--text-secondary); margin-bottom: 8px; }
  </style>
</head>
<body>
  <!-- LICENSE GATE -->
  <div class="license-gate" id="licenseGate">
    <div class="license-box">
      <img src="https://raw.githubusercontent.com/SysAdminDoc/RadAtlas/refs/heads/main/images/maven.png" alt="RadAtlas" class="license-logo">
      <div class="license-title">RadAtlas</div>
      <div class="license-subtitle">Enter your license key to continue</div>
      
      <div class="license-error" id="licenseError"></div>
      
      <form class="license-form" id="licenseForm">
        <label for="licenseKey">License Key</label>
        <input type="text" id="licenseKey" name="licenseKey" placeholder="XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX" required>
        <button type="submit" class="license-btn" id="licenseBtn">Activate License</button>
      </form>
      
      <div class="license-divider">or</div>
      
      <!-- IMPORTANT: Replace https://mavenimaging.lemonsqueezy.com/checkout/buy/1c8b67f2-2ad4-4a57-ae1a-0f9c4c8e3818 with your LemonSqueezy checkout link -->
      <a href="https://mavenimaging.lemonsqueezy.com/checkout/buy/1c8b67f2-2ad4-4a57-ae1a-0f9c4c8e3818" class="license-get-trial" target="_blank">Start Free 30-Day Trial â†’</a>
      
      <div class="license-footer">
        <img src="https://raw.githubusercontent.com/SysAdminDoc/RadAtlas/refs/heads/main/images/MavenLogo.png" alt="Maven Imaging">
        <p>Â© 2026 Maven Imaging, LLC</p>
      </div>
    </div>
  </div>

  <!-- TRIAL BANNER -->
  <div class="trial-banner hidden" id="trialBanner">
    <span class="trial-text">ðŸŽ‰ Free Trial: <span class="trial-days" id="trialDays">30 days</span> remaining</span>
    <!-- IMPORTANT: Replace https://mavenimaging.lemonsqueezy.com/checkout/buy/1c8b67f2-2ad4-4a57-ae1a-0f9c4c8e3818 with your LemonSqueezy checkout link -->
    <a href="https://mavenimaging.lemonsqueezy.com/checkout/buy/1c8b67f2-2ad4-4a57-ae1a-0f9c4c8e3818" class="trial-upgrade" target="_blank">Upgrade Now</a>
  </div>

  <!-- SPLASH SCREEN -->
  <div class="splash-screen hidden" id="splashScreen">
    <img src="https://raw.githubusercontent.com/SysAdminDoc/RadAtlas/refs/heads/main/images/maven.png" alt="Maven" class="splash-logo">
    <div class="splash-title">RadAtlas</div>
    <div class="splash-subtitle">X-Ray Technique Reference</div>
    <div class="splash-company">
      <img src="https://raw.githubusercontent.com/SysAdminDoc/RadAtlas/refs/heads/main/images/maven.png" alt="Maven">
      <span>Powered by Maven Imaging</span>
    </div>
  </div>

  <!-- HEADER -->
  <header class="header">
    <div class="header-brand" onclick="openAboutModal()" title="About RadAtlas">
      <img src="https://raw.githubusercontent.com/SysAdminDoc/RadAtlas/refs/heads/main/images/maven.png" alt="Maven Imaging" class="header-logo">
      <div class="header-titles">
        <div class="header-main-title">RadAtlas</div>
        <div class="header-tagline">
          X-Ray Technique Reference â€¢ <span class="maven-text">A Maven Imaging Product</span>
        </div>
      </div>
    </div>
    <div class="nav-tabs">
      <button class="nav-tab active" id="tabAnatomy" onclick="switchView('anatomy')">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
        <span>Body Select</span>
      </button>
      <button class="nav-tab" id="tabList" onclick="switchView('list')">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/></svg>
        <span>All Techniques</span>
      </button>
      <button class="nav-tab" id="tabFavorites" onclick="switchView('favorites')">
        <svg fill="currentColor" viewBox="0 0 24 24"><path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>
        <span>Favorites</span>
      </button>
    </div>
  </header>

  <!-- MAIN CONTAINER -->
  <div class="main-container">
    <aside class="anatomy-panel" id="anatomyPanel">
      <div class="anatomy-header">
        <div class="anatomy-title">Select Body Region</div>
        <div class="anatomy-hint">Click on a body part to see techniques</div>
        <div class="selected-region-badge" id="selectedBadge" style="display:none;"></div>
      </div>
      <div class="anatomy-container">
        <div class="anatomy-figure" id="anatomyFigure"></div>
      </div>
    </aside>

    <main class="techniques-panel">
      <div class="controls">
        <div class="search-row">
          <input type="text" class="search-box" id="searchBox" placeholder="Search body part, view, or region...">
          <button class="add-btn" onclick="openEditModal()">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M12 4v16m8-8H4"/></svg>
            Add New
          </button>
        </div>
        <div class="filter-row" id="regionFilters"></div>
        <div class="filter-row">
          <span style="font-size:12px;color:var(--text-muted);margin-right:8px;">Patient Size:</span>
          <div id="sizeFilters"></div>
        </div>
        <div class="stats-row">
          <div class="stats" id="stats"></div>
          <button class="reset-btn" onclick="resetToDefaults()">Reset to Defaults</button>
        </div>
      </div>
      <div class="grid-container">
        <div class="grid" id="grid"></div>
      </div>
    </main>
  </div>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-brand">
        <img src="https://raw.githubusercontent.com/SysAdminDoc/RadAtlas/refs/heads/main/images/maven.png" alt="Maven" class="footer-logo">
        <div>
          <div class="footer-company">Maven Imaging, LLC</div>
          <div class="footer-tagline">Professional Radiographic Solutions</div>
        </div>
      </div>
      <div class="footer-center">
        <div class="footer-disclaimer">Always verify techniques with facility protocols</div>
        <div class="footer-version">RadAtlas v1.0.0</div>
      </div>
      <div class="footer-right">
        <div class="footer-copyright">Â© 2026 Maven Imaging, LLC</div>
        <div class="footer-copyright">All rights reserved</div>
      </div>
    </div>
  </footer>

  <!-- VIEW MODAL -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal" id="modal"></div>
  </div>

  <!-- EDIT MODAL -->
  <div class="modal-overlay" id="editModalOverlay">
    <div class="modal edit-modal" id="editModal"></div>
  </div>

  <!-- ABOUT MODAL -->
  <div class="modal-overlay" id="aboutModalOverlay">
    <div class="modal about-modal" id="aboutModal"></div>
  </div>

  <script>
    // ============================================
    // LICENSE MANAGEMENT
    // ============================================
    
    const LICENSE_STORAGE_KEY = 'radatlas-license';
    const TRIAL_STORAGE_KEY = 'radatlas-trial-start';
    const TRIAL_DAYS = 30;
    
    // LemonSqueezy API endpoint for license validation
    const LEMON_VALIDATE_URL = 'https://api.lemonsqueezy.com/v1/licenses/validate';
    
    let licenseData = null;
    
    // Check license status on page load
    async function checkLicense() {
      const stored = localStorage.getItem(LICENSE_STORAGE_KEY);
      
      if (stored) {
        try {
          licenseData = JSON.parse(stored);
          
          // Re-validate with LemonSqueezy (in case subscription expired)
          const isValid = await validateLicenseKey(licenseData.key, false);
          
          if (isValid) {
            showApp();
            return;
          } else {
            // License no longer valid, clear it
            localStorage.removeItem(LICENSE_STORAGE_KEY);
            licenseData = null;
          }
        } catch (e) {
          console.error('License check error:', e);
        }
      }
      
      // No valid license, show gate
      showLicenseGate();
    }
    
    // Validate license key with LemonSqueezy
    async function validateLicenseKey(key, showErrors = true) {
      const errorEl = document.getElementById('licenseError');
      const btnEl = document.getElementById('licenseBtn');
      
      try {
        btnEl.disabled = true;
        btnEl.textContent = 'Validating...';
        
        const response = await fetch(LEMON_VALIDATE_URL, {
          method: 'POST',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            license_key: key,
            instance_name: 'RadAtlas Web App'
          })
        });
        
        const data = await response.json();
        
        if (data.valid || data.license_key?.status === 'active') {
          // License is valid!
          licenseData = {
            key: key,
            status: data.license_key?.status || 'active',
            customerEmail: data.meta?.customer_email || '',
            customerName: data.meta?.customer_name || '',
            productName: data.meta?.product_name || 'RadAtlas Pro',
            validatedAt: new Date().toISOString(),
            expiresAt: data.license_key?.expires_at || null
          };
          
          localStorage.setItem(LICENSE_STORAGE_KEY, JSON.stringify(licenseData));
          
          if (showErrors) {
            showApp();
          }
          return true;
        } else {
          // Invalid license
          if (showErrors) {
            errorEl.textContent = data.error || 'Invalid or expired license key. Please check and try again.';
            errorEl.classList.add('show');
          }
          return false;
        }
      } catch (error) {
        console.error('Validation error:', error);
        
        // If we can't reach the API, allow cached valid licenses
        if (licenseData && !showErrors) {
          return true; // Offline grace period
        }
        
        if (showErrors) {
          errorEl.textContent = 'Unable to validate license. Please check your internet connection.';
          errorEl.classList.add('show');
        }
        return false;
      } finally {
        btnEl.disabled = false;
        btnEl.textContent = 'Activate License';
      }
    }
    
    // Handle license form submission
    document.getElementById('licenseForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const key = document.getElementById('licenseKey').value.trim();
      document.getElementById('licenseError').classList.remove('show');
      
      if (key) {
        await validateLicenseKey(key, true);
      }
    });
    
    // Show license gate
    function showLicenseGate() {
      document.getElementById('licenseGate').classList.remove('hidden');
      document.querySelector('.header').style.display = 'none';
      document.querySelector('.main-container').style.display = 'none';
      document.querySelector('.footer').style.display = 'none';
      document.getElementById('trialBanner').classList.add('hidden');
    }
    
    // Show main app
    function showApp() {
      document.getElementById('licenseGate').classList.add('hidden');
      document.querySelector('.header').style.display = 'flex';
      document.querySelector('.main-container').style.display = 'flex';
      document.querySelector('.footer').style.display = 'block';
      
      // Show splash screen briefly
      const splash = document.getElementById('splashScreen');
      splash.classList.remove('hidden');
      setTimeout(() => {
        splash.classList.add('hidden');
      }, 1500);
      
      // Check if trial and show banner
      updateTrialBanner();
      
      // Initialize app
      initApp();
    }
    
    // Update trial banner
    function updateTrialBanner() {
      if (!licenseData) return;
      
      // Check if this is a trial (you can customize this based on LemonSqueezy product variant)
      const isTrial = licenseData.status === 'inactive' || 
                      licenseData.productName?.toLowerCase().includes('trial') ||
                      (licenseData.expiresAt && new Date(licenseData.expiresAt) > new Date());
      
      if (isTrial && licenseData.expiresAt) {
        const expiresAt = new Date(licenseData.expiresAt);
        const now = new Date();
        const daysLeft = Math.ceil((expiresAt - now) / (1000 * 60 * 60 * 24));
        
        if (daysLeft > 0 && daysLeft <= TRIAL_DAYS) {
          document.getElementById('trialDays').textContent = `${daysLeft} day${daysLeft !== 1 ? 's' : ''}`;
          document.getElementById('trialBanner').classList.remove('hidden');
        }
      }
    }
    
    // Logout / Clear license
    function logout() {
      if (confirm('Sign out and clear your license key?')) {
        localStorage.removeItem(LICENSE_STORAGE_KEY);
        licenseData = null;
        location.reload();
      }
    }
    
    // ============================================
    // MAIN APP CODE
    // ============================================
    
    // DEFAULT TECHNIQUE DATA (85 protocols)
    const defaultTechniques = [
      { id: 1, region: 'Head/Neck', bodyPart: 'Skull', view: 'AP', kVp: 68, mA: 200, grid: true, sid: 100, sidInches: 40, sizes: { small: 20, average: 25, large: 30 }, notes: 'Standard skull radiography' },
      { id: 2, region: 'Head/Neck', bodyPart: 'Skull', view: 'Lateral', kVp: 68, mA: 200, grid: true, sid: 100, sidInches: 40, sizes: { small: 20, average: 25, large: 30 }, notes: 'Cross-table or upright' },
      { id: 3, region: 'Head/Neck', bodyPart: 'Skull', view: 'Townes', kVp: 70, mA: 200, grid: true, sid: 100, sidInches: 40, sizes: { small: 25, average: 30, large: 40 }, notes: '30 deg caudal angulation' },
      { id: 4, region: 'Head/Neck', bodyPart: 'Facial Bones', view: 'Waters', kVp: 70, mA: 200, grid: true, sid: 100, sidInches: 40, sizes: { small: 20, average: 25, large: 32 }, notes: 'Maxillary sinuses' },
      { id: 5, region: 'Head/Neck', bodyPart: 'Sinuses', view: 'PA', kVp: 70, mA: 200, grid: true, sid: 100, sidInches: 40, sizes: { small: 16, average: 20, large: 25 }, notes: 'Frontal sinuses' },
      { id: 6, region: 'Head/Neck', bodyPart: 'Nasal Bones', view: 'Lateral', kVp: 50, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 4, average: 5, large: 6 }, notes: 'Soft tissue technique' },
      { id: 7, region: 'Head/Neck', bodyPart: 'TMJ', view: 'Open/Closed', kVp: 70, mA: 200, grid: true, sid: 100, sidInches: 40, sizes: { small: 16, average: 20, large: 25 }, notes: 'Bilateral comparison' },
      { id: 10, region: 'Spine', bodyPart: 'C-Spine', view: 'AP', kVp: 70, mA: 400, grid: true, sid: 100, sidInches: 40, sizes: { small: 10, average: 12.5, large: 20 }, notes: 'C3-C7 visualization' },
      { id: 11, region: 'Spine', bodyPart: 'C-Spine', view: 'Lateral', kVp: 70, mA: 400, grid: true, sid: 180, sidInches: 72, sizes: { small: 12.5, average: 20, large: 25 }, notes: '72 inch SID recommended' },
      { id: 12, region: 'Spine', bodyPart: 'C-Spine', view: 'Odontoid', kVp: 70, mA: 400, grid: true, sid: 100, sidInches: 40, sizes: { small: 10, average: 12.5, large: 20 }, notes: 'Open mouth AP' },
      { id: 13, region: 'Spine', bodyPart: 'C-Spine', view: 'Obliques', kVp: 70, mA: 400, grid: true, sid: 100, sidInches: 40, sizes: { small: 12.5, average: 16, large: 25 }, notes: '45 deg rotation' },
      { id: 14, region: 'Spine', bodyPart: 'C-Spine', view: 'Swimmers', kVp: 85, mA: 400, grid: true, sid: 100, sidInches: 40, sizes: { small: 40, average: 50, large: 64 }, notes: 'C7-T1 visualization' },
      { id: 15, region: 'Spine', bodyPart: 'T-Spine', view: 'AP', kVp: 70, mA: 400, grid: true, sid: 100, sidInches: 40, sizes: { small: 25, average: 32, large: 80 }, notes: 'T1-T12 visualization' },
      { id: 16, region: 'Spine', bodyPart: 'T-Spine', view: 'Lateral', kVp: 85, mA: 320, grid: true, sid: 100, sidInches: 40, sizes: { small: 25, average: 32, large: 80 }, notes: 'Breathing technique option' },
      { id: 17, region: 'Spine', bodyPart: 'L-Spine', view: 'AP', kVp: 75, mA: 400, grid: true, sid: 100, sidInches: 40, sizes: { small: 32, average: 40, large: 64 }, notes: 'L1-L5 visualization' },
      { id: 18, region: 'Spine', bodyPart: 'L-Spine', view: 'Lateral', kVp: 90, mA: 320, grid: true, sid: 100, sidInches: 40, sizes: { small: 80, average: 100, large: 125 }, notes: 'Include L5-S1' },
      { id: 19, region: 'Spine', bodyPart: 'L-Spine', view: 'L5-S1 Spot', kVp: 90, mA: 400, grid: true, sid: 100, sidInches: 40, sizes: { small: 64, average: 80, large: 100 }, notes: 'Coned lateral' },
      { id: 20, region: 'Spine', bodyPart: 'L-Spine', view: 'Obliques', kVp: 85, mA: 400, grid: true, sid: 100, sidInches: 40, sizes: { small: 50, average: 64, large: 80 }, notes: 'Scotty dog view' },
      { id: 21, region: 'Chest', bodyPart: 'Chest', view: 'PA', kVp: 110, mA: 200, grid: true, sid: 180, sidInches: 72, sizes: { small: 1.5, average: 3, large: 8 }, notes: '72 inch SID, inspiration' },
      { id: 22, region: 'Chest', bodyPart: 'Chest', view: 'Lateral', kVp: 110, mA: 200, grid: true, sid: 180, sidInches: 72, sizes: { small: 3, average: 5, large: 12 }, notes: 'Left lateral preferred' },
      { id: 23, region: 'Chest', bodyPart: 'Chest', view: 'AP Portable', kVp: 85, mA: 200, grid: false, sid: 100, sidInches: 40, sizes: { small: 4, average: 5, large: 8 }, notes: 'Portable/bedside' },
      { id: 24, region: 'Chest', bodyPart: 'Chest', view: 'Decubitus', kVp: 110, mA: 200, grid: true, sid: 180, sidInches: 72, sizes: { small: 3, average: 4, large: 8 }, notes: 'Fluid/air levels' },
      { id: 25, region: 'Chest', bodyPart: 'Ribs', view: 'AP Above Diaphragm', kVp: 65, mA: 200, grid: true, sid: 100, sidInches: 40, sizes: { small: 8, average: 10, large: 16 }, notes: 'Upper ribs, expiration' },
      { id: 26, region: 'Chest', bodyPart: 'Ribs', view: 'AP Below Diaphragm', kVp: 70, mA: 200, grid: true, sid: 100, sidInches: 40, sizes: { small: 16, average: 20, large: 32 }, notes: 'Lower ribs' },
      { id: 27, region: 'Chest', bodyPart: 'Sternum', view: 'RAO', kVp: 70, mA: 200, grid: true, sid: 100, sidInches: 40, sizes: { small: 16, average: 20, large: 32 }, notes: '15-20 deg RAO' },
      { id: 28, region: 'Chest', bodyPart: 'Sternum', view: 'Lateral', kVp: 70, mA: 200, grid: true, sid: 180, sidInches: 72, sizes: { small: 8, average: 12, large: 20 }, notes: '72 inch SID preferred' },
      { id: 31, region: 'Abdomen', bodyPart: 'Abdomen', view: 'AP Supine (KUB)', kVp: 75, mA: 200, grid: true, sid: 100, sidInches: 40, sizes: { small: 16, average: 20, large: 35 }, notes: 'Diaphragm to pubis' },
      { id: 32, region: 'Abdomen', bodyPart: 'Abdomen', view: 'AP Upright', kVp: 75, mA: 200, grid: true, sid: 100, sidInches: 40, sizes: { small: 16, average: 20, large: 35 }, notes: 'Air-fluid levels' },
      { id: 33, region: 'Abdomen', bodyPart: 'Abdomen', view: 'Left Lateral Decub', kVp: 75, mA: 200, grid: true, sid: 100, sidInches: 40, sizes: { small: 20, average: 25, large: 40 }, notes: 'Free air detection' },
      { id: 34, region: 'Abdomen', bodyPart: 'Pelvis', view: 'AP', kVp: 75, mA: 400, grid: true, sid: 100, sidInches: 40, sizes: { small: 32, average: 40, large: 64 }, notes: 'Include both hips' },
      { id: 35, region: 'Abdomen', bodyPart: 'Sacrum', view: 'AP', kVp: 75, mA: 400, grid: true, sid: 100, sidInches: 40, sizes: { small: 40, average: 50, large: 80 }, notes: '15 deg cephalad' },
      { id: 36, region: 'Abdomen', bodyPart: 'Coccyx', view: 'AP', kVp: 70, mA: 400, grid: true, sid: 100, sidInches: 40, sizes: { small: 25, average: 32, large: 50 }, notes: '10 deg caudad' },
      { id: 37, region: 'Abdomen', bodyPart: 'Hip', view: 'AP', kVp: 80, mA: 200, grid: true, sid: 100, sidInches: 40, sizes: { small: 20, average: 25, large: 30 }, notes: 'Unilateral hip' },
      { id: 38, region: 'Abdomen', bodyPart: 'Hip', view: 'Frog Lateral', kVp: 80, mA: 200, grid: true, sid: 100, sidInches: 40, sizes: { small: 25, average: 32, large: 40 }, notes: 'Modified Cleaves' },
      { id: 39, region: 'Abdomen', bodyPart: 'Hip', view: 'Cross-Table Lat', kVp: 85, mA: 200, grid: true, sid: 100, sidInches: 40, sizes: { small: 40, average: 50, large: 64 }, notes: 'Trauma hip' },
      { id: 40, region: 'Upper Extremity', bodyPart: 'Shoulder', view: 'AP Internal', kVp: 70, mA: 200, grid: false, sid: 100, sidInches: 40, sizes: { small: 5, average: 8, large: 18 }, notes: 'Internal rotation' },
      { id: 41, region: 'Upper Extremity', bodyPart: 'Shoulder', view: 'AP External', kVp: 70, mA: 200, grid: false, sid: 100, sidInches: 40, sizes: { small: 5, average: 8, large: 18 }, notes: 'External rotation' },
      { id: 42, region: 'Upper Extremity', bodyPart: 'Shoulder', view: 'Y-View', kVp: 75, mA: 200, grid: false, sid: 100, sidInches: 40, sizes: { small: 8, average: 12, large: 20 }, notes: 'Scapular Y outlet' },
      { id: 43, region: 'Upper Extremity', bodyPart: 'Shoulder', view: 'Axillary', kVp: 70, mA: 200, grid: false, sid: 100, sidInches: 40, sizes: { small: 6, average: 10, large: 16 }, notes: 'Inferosuperior' },
      { id: 44, region: 'Upper Extremity', bodyPart: 'Clavicle', view: 'AP', kVp: 70, mA: 200, grid: false, sid: 100, sidInches: 40, sizes: { small: 5, average: 8, large: 16 }, notes: '0 or 15 deg cephalad' },
      { id: 45, region: 'Upper Extremity', bodyPart: 'Scapula', view: 'AP', kVp: 70, mA: 200, grid: false, sid: 100, sidInches: 40, sizes: { small: 6, average: 10, large: 18 }, notes: 'Abduct arm' },
      { id: 46, region: 'Upper Extremity', bodyPart: 'Humerus', view: 'AP', kVp: 60, mA: 200, grid: false, sid: 100, sidInches: 40, sizes: { small: 5, average: 8, large: 18 }, notes: 'Include shoulder and elbow' },
      { id: 47, region: 'Upper Extremity', bodyPart: 'Humerus', view: 'Lateral', kVp: 60, mA: 200, grid: false, sid: 100, sidInches: 40, sizes: { small: 5, average: 8, large: 18 }, notes: 'Transthoracic if needed' },
      { id: 48, region: 'Upper Extremity', bodyPart: 'Elbow', view: 'AP', kVp: 55, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 4, average: 5, large: 7 }, notes: 'Arm extended' },
      { id: 49, region: 'Upper Extremity', bodyPart: 'Elbow', view: 'Lateral', kVp: 55, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 4, average: 5, large: 7 }, notes: '90 deg flexion' },
      { id: 50, region: 'Upper Extremity', bodyPart: 'Elbow', view: 'Obliques', kVp: 55, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 4, average: 5, large: 7 }, notes: 'Internal and external' },
      { id: 51, region: 'Upper Extremity', bodyPart: 'Forearm', view: 'AP', kVp: 55, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 4, average: 5, large: 7 }, notes: 'Include wrist and elbow' },
      { id: 52, region: 'Upper Extremity', bodyPart: 'Forearm', view: 'Lateral', kVp: 55, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 4, average: 5, large: 7 }, notes: '90 deg elbow flexion' },
      { id: 53, region: 'Upper Extremity', bodyPart: 'Wrist', view: 'PA', kVp: 52, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 4, average: 4, large: 6 }, notes: 'Carpal visualization' },
      { id: 54, region: 'Upper Extremity', bodyPart: 'Wrist', view: 'Lateral', kVp: 52, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 3, average: 4, large: 5 }, notes: 'Ulnar side down' },
      { id: 55, region: 'Upper Extremity', bodyPart: 'Wrist', view: 'Scaphoid', kVp: 52, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 3, average: 4, large: 5 }, notes: 'Ulnar deviation' },
      { id: 56, region: 'Upper Extremity', bodyPart: 'Hand', view: 'PA', kVp: 50, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 3, average: 4, large: 6 }, notes: 'Fingers spread' },
      { id: 57, region: 'Upper Extremity', bodyPart: 'Hand', view: 'Oblique', kVp: 50, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 3, average: 4, large: 5 }, notes: '45 deg lateral rotation' },
      { id: 58, region: 'Upper Extremity', bodyPart: 'Hand', view: 'Lateral', kVp: 50, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 3, average: 4, large: 5 }, notes: 'Fan lateral' },
      { id: 59, region: 'Upper Extremity', bodyPart: 'Fingers', view: 'PA', kVp: 50, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 2, average: 3, large: 4 }, notes: 'Individual digit' },
      { id: 60, region: 'Upper Extremity', bodyPart: 'Thumb', view: 'AP/Oblique', kVp: 50, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 2, average: 3, large: 4 }, notes: 'Modified Roberts' },
      { id: 61, region: 'Lower Extremity', bodyPart: 'Femur', view: 'AP', kVp: 70, mA: 150, grid: true, sid: 100, sidInches: 40, sizes: { small: 8, average: 12, large: 25 }, notes: 'Include hip or knee' },
      { id: 62, region: 'Lower Extremity', bodyPart: 'Femur', view: 'Lateral', kVp: 70, mA: 150, grid: true, sid: 100, sidInches: 40, sizes: { small: 8, average: 12, large: 25 }, notes: 'Cross-table or frog' },
      { id: 63, region: 'Lower Extremity', bodyPart: 'Knee', view: 'AP', kVp: 60, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 5, average: 8, large: 10 }, notes: '5 deg cephalad' },
      { id: 64, region: 'Lower Extremity', bodyPart: 'Knee', view: 'Lateral', kVp: 60, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 5, average: 8, large: 10 }, notes: '20-30 deg flexion' },
      { id: 65, region: 'Lower Extremity', bodyPart: 'Knee', view: 'Tunnel', kVp: 65, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 6, average: 10, large: 12 }, notes: 'Camp-Coventry method' },
      { id: 66, region: 'Lower Extremity', bodyPart: 'Patella', view: 'PA', kVp: 60, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 5, average: 8, large: 10 }, notes: 'Knee prone' },
      { id: 67, region: 'Lower Extremity', bodyPart: 'Patella', view: 'Sunrise', kVp: 60, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 5, average: 8, large: 10 }, notes: 'Merchant or Settegast' },
      { id: 68, region: 'Lower Extremity', bodyPart: 'Tibia/Fibula', view: 'AP', kVp: 60, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 5, average: 6, large: 10 }, notes: 'Include knee and ankle' },
      { id: 69, region: 'Lower Extremity', bodyPart: 'Tibia/Fibula', view: 'Lateral', kVp: 60, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 5, average: 6, large: 10 }, notes: 'Medial side down' },
      { id: 70, region: 'Lower Extremity', bodyPart: 'Ankle', view: 'AP', kVp: 55, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 3, average: 5, large: 6 }, notes: 'Mortise for joint space' },
      { id: 71, region: 'Lower Extremity', bodyPart: 'Ankle', view: 'Lateral', kVp: 55, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 3, average: 4, large: 6 }, notes: '90 deg dorsiflexion' },
      { id: 72, region: 'Lower Extremity', bodyPart: 'Ankle', view: 'Mortise', kVp: 55, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 3, average: 5, large: 6 }, notes: '15-20 deg internal rotation' },
      { id: 73, region: 'Lower Extremity', bodyPart: 'Calcaneus', view: 'Axial', kVp: 55, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 5, average: 6, large: 8 }, notes: '40 deg cephalad' },
      { id: 74, region: 'Lower Extremity', bodyPart: 'Calcaneus', view: 'Lateral', kVp: 55, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 3, average: 4, large: 5 }, notes: 'Lateral surface down' },
      { id: 75, region: 'Lower Extremity', bodyPart: 'Foot', view: 'AP/DP', kVp: 55, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 3, average: 4, large: 6 }, notes: '10 deg toward heel' },
      { id: 76, region: 'Lower Extremity', bodyPart: 'Foot', view: 'Oblique', kVp: 55, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 3, average: 4, large: 5 }, notes: '30-40 deg medial rotation' },
      { id: 77, region: 'Lower Extremity', bodyPart: 'Foot', view: 'Lateral', kVp: 55, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 3, average: 4, large: 5 }, notes: 'Weight-bearing optional' },
      { id: 78, region: 'Lower Extremity', bodyPart: 'Toes', view: 'AP', kVp: 50, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 2, average: 3, large: 4 }, notes: '15 deg toward heel' },
      { id: 79, region: 'Lower Extremity', bodyPart: 'Toes', view: 'Oblique', kVp: 50, mA: 100, grid: false, sid: 100, sidInches: 40, sizes: { small: 2, average: 3, large: 4 }, notes: '30-45 deg medial' }
    ];

    // HOTSPOT DEFINITIONS
    const hotspots = [
      { id: 'head', label: 'Head/Skull', top: 0, left: 35, width: 30, height: 12, bodyParts: ['Skull', 'Facial Bones', 'Sinuses', 'Nasal Bones', 'TMJ'] },
      { id: 'cspine', label: 'C-Spine', top: 11, left: 42, width: 16, height: 6, bodyParts: ['C-Spine'] },
      { id: 'shoulder-l', label: 'Shoulder', top: 15, left: 24, width: 14, height: 8, bodyParts: ['Shoulder', 'Clavicle', 'Scapula'] },
      { id: 'shoulder-r', label: 'Shoulder', top: 15, left: 62, width: 14, height: 8, bodyParts: ['Shoulder', 'Clavicle', 'Scapula'] },
      { id: 'chest', label: 'Chest/Ribs', top: 17, left: 34, width: 32, height: 17, bodyParts: ['Chest', 'Ribs', 'Sternum'] },
      { id: 'tspine', label: 'T-Spine', top: 20, left: 44, width: 12, height: 14, bodyParts: ['T-Spine'] },
      { id: 'humerus-l', label: 'Humerus', top: 22, left: 21, width: 10, height: 16, bodyParts: ['Humerus'] },
      { id: 'humerus-r', label: 'Humerus', top: 22, left: 69, width: 10, height: 16, bodyParts: ['Humerus'] },
      { id: 'abdomen', label: 'Abdomen', top: 34, left: 34, width: 32, height: 12, bodyParts: ['Abdomen'] },
      { id: 'lspine', label: 'L-Spine', top: 34, left: 44, width: 12, height: 12, bodyParts: ['L-Spine'] },
      { id: 'elbow-l', label: 'Elbow', top: 37, left: 18, width: 9, height: 7, bodyParts: ['Elbow'] },
      { id: 'elbow-r', label: 'Elbow', top: 37, left: 73, width: 9, height: 7, bodyParts: ['Elbow'] },
      { id: 'pelvis', label: 'Pelvis/Hip', top: 44, left: 30, width: 40, height: 12, bodyParts: ['Pelvis', 'Hip', 'Sacrum', 'Coccyx'] },
      { id: 'forearm-l', label: 'Forearm', top: 43, left: 15, width: 9, height: 13, bodyParts: ['Forearm'] },
      { id: 'forearm-r', label: 'Forearm', top: 43, left: 76, width: 9, height: 13, bodyParts: ['Forearm'] },
      { id: 'wrist-l', label: 'Wrist', top: 55, left: 13, width: 8, height: 5, bodyParts: ['Wrist'] },
      { id: 'wrist-r', label: 'Wrist', top: 55, left: 79, width: 8, height: 5, bodyParts: ['Wrist'] },
      { id: 'hand-l', label: 'Hand', top: 59, left: 10, width: 12, height: 10, bodyParts: ['Hand', 'Fingers', 'Thumb'] },
      { id: 'hand-r', label: 'Hand', top: 59, left: 78, width: 12, height: 10, bodyParts: ['Hand', 'Fingers', 'Thumb'] },
      { id: 'femur-l', label: 'Femur', top: 54, left: 33, width: 13, height: 18, bodyParts: ['Femur'] },
      { id: 'femur-r', label: 'Femur', top: 54, left: 54, width: 13, height: 18, bodyParts: ['Femur'] },
      { id: 'knee-l', label: 'Knee', top: 70, left: 34, width: 11, height: 8, bodyParts: ['Knee', 'Patella'] },
      { id: 'knee-r', label: 'Knee', top: 70, left: 55, width: 11, height: 8, bodyParts: ['Knee', 'Patella'] },
      { id: 'tibia-l', label: 'Tibia/Fibula', top: 77, left: 35, width: 9, height: 14, bodyParts: ['Tibia/Fibula'] },
      { id: 'tibia-r', label: 'Tibia/Fibula', top: 77, left: 56, width: 9, height: 14, bodyParts: ['Tibia/Fibula'] },
      { id: 'ankle-l', label: 'Ankle', top: 90, left: 35, width: 9, height: 5, bodyParts: ['Ankle', 'Calcaneus'] },
      { id: 'ankle-r', label: 'Ankle', top: 90, left: 56, width: 9, height: 5, bodyParts: ['Ankle', 'Calcaneus'] },
      { id: 'foot-l', label: 'Foot', top: 94, left: 32, width: 13, height: 6, bodyParts: ['Foot', 'Toes'] },
      { id: 'foot-r', label: 'Foot', top: 94, left: 55, width: 13, height: 6, bodyParts: ['Foot', 'Toes'] }
    ];

    const bodyPartOptions = ['Skull', 'Facial Bones', 'Sinuses', 'Nasal Bones', 'TMJ', 'C-Spine', 'T-Spine', 'L-Spine', 'Chest', 'Ribs', 'Sternum', 'Abdomen', 'Pelvis', 'Sacrum', 'Coccyx', 'Hip', 'Shoulder', 'Clavicle', 'Scapula', 'Humerus', 'Elbow', 'Forearm', 'Wrist', 'Hand', 'Fingers', 'Thumb', 'Femur', 'Knee', 'Patella', 'Tibia/Fibula', 'Ankle', 'Calcaneus', 'Foot', 'Toes'];
    const regionMap = {
      'Skull': 'Head/Neck', 'Facial Bones': 'Head/Neck', 'Sinuses': 'Head/Neck', 'Nasal Bones': 'Head/Neck', 'TMJ': 'Head/Neck',
      'C-Spine': 'Spine', 'T-Spine': 'Spine', 'L-Spine': 'Spine',
      'Chest': 'Chest', 'Ribs': 'Chest', 'Sternum': 'Chest',
      'Abdomen': 'Abdomen', 'Pelvis': 'Abdomen', 'Sacrum': 'Abdomen', 'Coccyx': 'Abdomen', 'Hip': 'Abdomen',
      'Shoulder': 'Upper Extremity', 'Clavicle': 'Upper Extremity', 'Scapula': 'Upper Extremity', 'Humerus': 'Upper Extremity', 'Elbow': 'Upper Extremity', 'Forearm': 'Upper Extremity', 'Wrist': 'Upper Extremity', 'Hand': 'Upper Extremity', 'Fingers': 'Upper Extremity', 'Thumb': 'Upper Extremity',
      'Femur': 'Lower Extremity', 'Knee': 'Lower Extremity', 'Patella': 'Lower Extremity', 'Tibia/Fibula': 'Lower Extremity', 'Ankle': 'Lower Extremity', 'Calcaneus': 'Lower Extremity', 'Foot': 'Lower Extremity', 'Toes': 'Lower Extremity'
    };
    const regions = ['All', 'Head/Neck', 'Spine', 'Chest', 'Upper Extremity', 'Lower Extremity', 'Abdomen'];
    const sizeLabels = ['small', 'average', 'large'];

    // STATE
    let techniques = [];
    let currentView = 'anatomy';
    let currentRegion = 'All';
    let currentSize = 'average';
    let searchQuery = '';
    let selectedBodyParts = [];
    let favorites = [];
    let editingId = null;

    // DOM ELEMENTS
    let anatomyFigure, anatomyPanel, selectedBadge, searchBox, regionFilters, sizeFilters, stats, grid, modalOverlay, modal, editModalOverlay, editModal;

    function initApp() {
      anatomyFigure = document.getElementById('anatomyFigure');
      anatomyPanel = document.getElementById('anatomyPanel');
      selectedBadge = document.getElementById('selectedBadge');
      searchBox = document.getElementById('searchBox');
      regionFilters = document.getElementById('regionFilters');
      sizeFilters = document.getElementById('sizeFilters');
      stats = document.getElementById('stats');
      grid = document.getElementById('grid');
      modalOverlay = document.getElementById('modalOverlay');
      modal = document.getElementById('modal');
      editModalOverlay = document.getElementById('editModalOverlay');
      editModal = document.getElementById('editModal');

      loadData();
      initAnatomy();
      renderFilters();
      renderGrid();
      setupEventListeners();
    }

    function loadData() {
      try {
        const saved = localStorage.getItem('radatlas-techniques');
        techniques = saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(defaultTechniques));
        favorites = JSON.parse(localStorage.getItem('radatlas-favs') || '[]');
      } catch(e) {
        techniques = JSON.parse(JSON.stringify(defaultTechniques));
        favorites = [];
      }
    }

    function saveData() {
      try {
        localStorage.setItem('radatlas-techniques', JSON.stringify(techniques));
        localStorage.setItem('radatlas-favs', JSON.stringify(favorites));
      } catch(e) {}
    }

    function resetToDefaults() {
      if (confirm('Reset all techniques to defaults? This will remove any custom entries and edits.')) {
        techniques = JSON.parse(JSON.stringify(defaultTechniques));
        saveData();
        renderGrid();
      }
    }

    function initAnatomy() {
      const img = document.createElement('img');
      img.src = 'https://raw.githubusercontent.com/SysAdminDoc/RadAtlas/refs/heads/main/images/Human.png';
      img.alt = 'Human Anatomy';
      img.style.opacity = '0';
      img.style.transition = 'opacity 0.3s';
      img.onload = function() { img.style.opacity = '1'; };
      img.onerror = function() { img.style.opacity = '1'; };
      anatomyFigure.appendChild(img);
      setTimeout(() => { img.style.opacity = '1'; }, 500);
      
      hotspots.forEach(h => {
        const el = document.createElement('div');
        el.className = 'hotspot';
        el.dataset.id = h.id;
        el.style.cssText = `top:${h.top}%;left:${h.left}%;width:${h.width}%;height:${h.height}%;`;
        el.innerHTML = `<span class="hotspot-label">${h.label}</span>`;
        el.addEventListener('click', () => selectHotspot(h));
        anatomyFigure.appendChild(el);
      });
    }

    function selectHotspot(h) {
      document.querySelectorAll('.hotspot').forEach(el => el.classList.remove('active'));
      hotspots.filter(hs => hs.bodyParts.some(bp => h.bodyParts.includes(bp)))
        .forEach(hs => {
          const el = document.querySelector(`.hotspot[data-id="${hs.id}"]`);
          if (el) el.classList.add('active');
        });
      selectedBodyParts = h.bodyParts;
      selectedBadge.textContent = h.label;
      selectedBadge.style.display = 'inline-block';
      currentRegion = 'All';
      searchQuery = '';
      searchBox.value = '';
      renderFilters();
      renderGrid();
    }

    function clearSelection() {
      document.querySelectorAll('.hotspot').forEach(el => el.classList.remove('active'));
      selectedBodyParts = [];
      selectedBadge.style.display = 'none';
      renderGrid();
    }

    function switchView(view) {
      currentView = view;
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      document.getElementById('tab' + view.charAt(0).toUpperCase() + view.slice(1)).classList.add('active');
      anatomyPanel.style.display = view === 'anatomy' ? 'flex' : 'none';
      if (view !== 'anatomy') clearSelection();
      if (view === 'favorites') currentRegion = 'All';
      renderFilters();
      renderGrid();
    }

    function renderFilters() {
      regionFilters.innerHTML = regions.map(r => 
        `<button class="filter-btn ${r === currentRegion ? 'active' : ''}" data-region="${r}">${r}</button>`
      ).join('');
      sizeFilters.innerHTML = sizeLabels.map(s => 
        `<button class="size-btn ${s === currentSize ? 'active' : ''}" data-size="${s}">${s.charAt(0).toUpperCase() + s.slice(1)}</button>`
      ).join('');
    }

    function renderGrid() {
      let filtered = techniques;
      if (selectedBodyParts.length > 0) {
        filtered = filtered.filter(t => selectedBodyParts.includes(t.bodyPart));
      }
      if (currentRegion !== 'All') {
        filtered = filtered.filter(t => t.region === currentRegion);
      }
      if (searchQuery) {
        const q = searchQuery.toLowerCase();
        filtered = filtered.filter(t => 
          t.bodyPart.toLowerCase().includes(q) ||
          t.view.toLowerCase().includes(q) ||
          t.region.toLowerCase().includes(q) ||
          (t.notes && t.notes.toLowerCase().includes(q))
        );
      }
      if (currentView === 'favorites') {
        filtered = filtered.filter(t => favorites.includes(t.id));
      }
      filtered.sort((a, b) => {
        const aFav = favorites.includes(a.id);
        const bFav = favorites.includes(b.id);
        if (aFav && !bFav) return -1;
        if (!aFav && bFav) return 1;
        return a.bodyPart.localeCompare(b.bodyPart) || a.view.localeCompare(b.view);
      });

      const customCount = techniques.filter(t => t.custom).length;
      stats.textContent = `${filtered.length} technique${filtered.length !== 1 ? 's' : ''} â€¢ ${favorites.length} favorited${customCount ? ` â€¢ ${customCount} custom` : ''}`;

      if (filtered.length === 0) {
        grid.innerHTML = `
          <div class="empty-state" style="grid-column: 1/-1;">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M12 2a10 10 0 100 20 10 10 0 000-20z"/></svg>
            <h3>${currentView === 'favorites' ? 'No favorites yet' : 'No techniques found'}</h3>
            <p>${currentView === 'favorites' ? 'Star techniques to add them here' : 'Try adjusting your search or filters'}</p>
          </div>`;
        return;
      }

      grid.innerHTML = filtered.map(t => {
        const isFav = favorites.includes(t.id);
        const mAs = t.sizes[currentSize];
        return `
          <div class="card ${isFav ? 'favorited' : ''} ${t.custom ? 'custom' : ''}" data-id="${t.id}">
            <div class="card-actions">
              <button class="card-btn fav-btn ${isFav ? 'active' : ''}" onclick="event.stopPropagation(); toggleFav(${t.id})" title="Favorite">
                <svg fill="${isFav ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>
              </button>
              <button class="card-btn edit-btn" onclick="event.stopPropagation(); openEditModal(${t.id})" title="Edit">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
              </button>
            </div>
            <div class="card-region">${t.region}${t.custom ? '<span class="custom-badge">Custom</span>' : ''}</div>
            <div class="card-body">${t.bodyPart}</div>
            <div class="card-view">${t.view}</div>
            <div class="card-values">
              <div class="value-box"><div class="value-label">kVp</div><div class="value-num">${t.kVp}</div></div>
              <div class="value-box"><div class="value-label">mAs</div><div class="value-num">${mAs}</div></div>
            </div>
            <div class="card-meta">
              <span class="${t.grid ? 'grid-yes' : ''}">Grid: ${t.grid ? 'Yes' : 'No'}</span>
              <span>SID: ${t.sidInches}"</span>
            </div>
          </div>`;
      }).join('');

      document.querySelectorAll('.card').forEach(card => {
        card.addEventListener('click', () => openModal(parseInt(card.dataset.id)));
      });
    }

    function toggleFav(id) {
      if (favorites.includes(id)) {
        favorites = favorites.filter(f => f !== id);
      } else {
        favorites.push(id);
      }
      saveData();
      renderGrid();
    }

    function openModal(id) {
      const t = techniques.find(tech => tech.id === id);
      if (!t) return;
      modal.innerHTML = `
        <div class="modal-header">
          <div>
            <div class="modal-region">${t.region}${t.custom ? '<span class="custom-badge" style="margin-left:8px;">Custom</span>' : ''}</div>
            <div class="modal-title">${t.bodyPart}</div>
            <div class="modal-view">${t.view}</div>
          </div>
          <button class="modal-close" onclick="closeModal()">âœ•</button>
        </div>
        <div class="modal-values">
          <div class="modal-value"><div class="modal-value-label">kVp</div><div class="modal-value-num">${t.kVp}</div></div>
          <div class="modal-value" style="background:rgba(91,164,230,0.15);"><div class="modal-value-label">mAs (${currentSize})</div><div class="modal-value-num" style="color:var(--maven-blue);">${t.sizes[currentSize]}</div></div>
          <div class="modal-value"><div class="modal-value-label">SID</div><div class="modal-value-num">${t.sidInches}"</div></div>
        </div>
        <div class="modal-section">
          <div class="modal-section-title">Patient Size Adjustments</div>
          <div class="modal-sizes">
            ${sizeLabels.map(s => `<div class="modal-size-box ${s === currentSize ? 'active' : ''}"><div class="modal-size-label">${s}</div><div class="modal-size-value">${t.sizes[s]} mAs</div></div>`).join('')}
          </div>
        </div>
        <div class="modal-section">
          <div class="modal-section-title">Grid</div>
          <div class="modal-note" style="color:${t.grid ? '#22c55e' : 'var(--text-secondary)'}">${t.grid ? 'Yes - Use Grid' : 'No - Non-Grid'}</div>
        </div>
        ${t.notes ? `<div class="modal-section"><div class="modal-section-title">Notes</div><div class="modal-note">${t.notes}</div></div>` : ''}
        <div class="modal-actions">
          <button class="btn-edit" onclick="closeModal(); openEditModal(${t.id})">Edit Technique</button>
          <button class="btn-delete" onclick="deleteTechnique(${t.id})">Delete</button>
        </div>`;
      modalOverlay.classList.add('open');
    }

    function closeModal() { modalOverlay.classList.remove('open'); }

    function openEditModal(id = null) {
      editingId = id;
      const t = id ? techniques.find(tech => tech.id === id) : null;
      const isNew = !t;
      
      editModal.innerHTML = `
        <div class="modal-header">
          <h2>${isNew ? 'Add New Technique' : 'Edit Technique'}</h2>
          <button class="modal-close" onclick="closeEditModal()">âœ•</button>
        </div>
        <form id="editForm" onsubmit="saveTechnique(event)">
          <div class="form-row">
            <div class="form-group">
              <label>Body Part <span>*</span></label>
              <select name="bodyPart" required>
                <option value="">Select body part</option>
                ${bodyPartOptions.map(bp => `<option value="${bp}" ${t && t.bodyPart === bp ? 'selected' : ''}>${bp}</option>`).join('')}
              </select>
            </div>
            <div class="form-group">
              <label>Region</label>
              <input type="text" name="region" value="${t ? t.region : ''}" placeholder="Auto-detected" readonly style="color:var(--text-muted);">
            </div>
            <div class="form-group">
              <label>Projection/View <span>*</span></label>
              <input type="text" name="view" value="${t ? t.view : ''}" placeholder="e.g., AP, Lateral" required>
            </div>
          </div>
          <div class="form-row two-col">
            <div class="form-group">
              <label>kVp</label>
              <input type="number" name="kVp" value="${t ? t.kVp : ''}" placeholder="e.g., 75">
            </div>
            <div class="form-group">
              <label>mA</label>
              <input type="number" name="mA" value="${t ? t.mA : ''}" placeholder="e.g., 200">
            </div>
          </div>
          <div class="form-group">
            <label>mAs by Patient Size</label>
          </div>
          <div class="mas-table">
            <div class="mas-table-header"><span>Patient Size</span><span>mAs</span></div>
            <div class="mas-table-row"><span>Small</span><input type="number" step="0.1" name="masSmall" value="${t ? t.sizes.small : ''}" placeholder="mAs"></div>
            <div class="mas-table-row"><span>Average</span><input type="number" step="0.1" name="masAverage" value="${t ? t.sizes.average : ''}" placeholder="mAs"></div>
            <div class="mas-table-row"><span>Large</span><input type="number" step="0.1" name="masLarge" value="${t ? t.sizes.large : ''}" placeholder="mAs"></div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>SID (cm)</label>
              <input type="number" name="sid" value="${t ? t.sid : '100'}" placeholder="100">
            </div>
            <div class="form-group">
              <label>SID (inch)</label>
              <input type="number" name="sidInches" value="${t ? t.sidInches : '40'}" placeholder="40">
            </div>
            <div class="form-group">
              <label>Grid</label>
              <select name="grid">
                <option value="false" ${t && !t.grid ? 'selected' : ''}>No</option>
                <option value="true" ${t && t.grid ? 'selected' : ''}>Yes</option>
              </select>
            </div>
          </div>
          <div class="form-group full-width">
            <label>Notes</label>
            <textarea name="notes" placeholder="Additional technique notes or instructions...">${t ? t.notes || '' : ''}</textarea>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-cancel" onclick="closeEditModal()">Cancel</button>
            <button type="submit" class="btn-save">${isNew ? 'Add Technique' : 'Update Technique'}</button>
          </div>
        </form>`;
      
      const bpSelect = editModal.querySelector('select[name="bodyPart"]');
      const regionInput = editModal.querySelector('input[name="region"]');
      bpSelect.addEventListener('change', () => {
        regionInput.value = regionMap[bpSelect.value] || '';
      });
      
      editModalOverlay.classList.add('open');
    }

    function closeEditModal() { editModalOverlay.classList.remove('open'); editingId = null; }

    function saveTechnique(e) {
      e.preventDefault();
      const form = e.target;
      const data = {
        bodyPart: form.bodyPart.value,
        region: regionMap[form.bodyPart.value] || form.region.value,
        view: form.view.value,
        kVp: parseFloat(form.kVp.value) || 70,
        mA: parseFloat(form.mA.value) || 200,
        grid: form.grid.value === 'true',
        sid: parseFloat(form.sid.value) || 100,
        sidInches: parseFloat(form.sidInches.value) || 40,
        sizes: {
          small: parseFloat(form.masSmall.value) || 0,
          average: parseFloat(form.masAverage.value) || 0,
          large: parseFloat(form.masLarge.value) || 0
        },
        notes: form.notes.value,
        custom: true
      };

      if (editingId) {
        const idx = techniques.findIndex(t => t.id === editingId);
        if (idx !== -1) {
          techniques[idx] = { ...techniques[idx], ...data };
        }
      } else {
        data.id = Date.now();
        techniques.push(data);
      }
      
      saveData();
      closeEditModal();
      renderGrid();
    }

    function deleteTechnique(id) {
      if (confirm('Delete this technique?')) {
        techniques = techniques.filter(t => t.id !== id);
        favorites = favorites.filter(f => f !== id);
        saveData();
        closeModal();
        renderGrid();
      }
    }

    // ABOUT MODAL
    const aboutModalOverlay = document.getElementById('aboutModalOverlay');
    
    function openAboutModal() {
      const aboutModal = document.getElementById('aboutModal');
      const statusClass = licenseData?.status === 'active' ? '' : 'trial';
      const statusText = licenseData?.status === 'active' ? 'Active Subscription' : 'Trial';
      
      aboutModal.innerHTML = `
        <button class="modal-close" onclick="closeAboutModal()" style="position:absolute;top:16px;right:16px;">âœ•</button>
        <img src="https://raw.githubusercontent.com/SysAdminDoc/RadAtlas/refs/heads/main/images/maven.png" alt="RadAtlas" class="about-logo">
        <div class="about-title">RadAtlas</div>
        <div class="about-version">Version 1.0.0</div>
        <div class="about-description">
          Professional X-Ray technique reference application featuring interactive anatomy selection, 
          customizable protocols, and patient size adjustments.
        </div>
        <div class="about-license">
          <div class="about-license-label">License Status</div>
          <div class="about-license-status ${statusClass}">${statusText}</div>
          ${licenseData?.customerEmail ? `<div style="margin-top:4px;color:var(--text-muted);">${licenseData.customerEmail}</div>` : ''}
        </div>
        <div class="about-divider"></div>
        <img src="https://raw.githubusercontent.com/SysAdminDoc/RadAtlas/refs/heads/main/images/MavenLogo.png" alt="Maven Imaging" class="about-company-logo">
        <div class="about-company-name">Maven Imaging, LLC</div>
        <a href="https://www.mavenimaging.com" target="_blank" class="about-website">www.mavenimaging.com</a>
        <div class="about-copyright">Â© 2026 Maven Imaging, LLC. All rights reserved.</div>
        <button class="about-logout" onclick="logout()">Sign Out</button>
      `;
      aboutModalOverlay.classList.add('open');
    }
    
    function closeAboutModal() { aboutModalOverlay.classList.remove('open'); }

    function setupEventListeners() {
      searchBox.addEventListener('input', (e) => { searchQuery = e.target.value; clearSelection(); renderGrid(); });
      regionFilters.addEventListener('click', (e) => { if (e.target.dataset.region) { currentRegion = e.target.dataset.region; clearSelection(); renderFilters(); renderGrid(); } });
      sizeFilters.addEventListener('click', (e) => { if (e.target.dataset.size) { currentSize = e.target.dataset.size; renderFilters(); renderGrid(); } });
      modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) closeModal(); });
      editModalOverlay.addEventListener('click', (e) => { if (e.target === editModalOverlay) closeEditModal(); });
      aboutModalOverlay.addEventListener('click', (e) => { if (e.target === aboutModalOverlay) closeAboutModal(); });
      document.addEventListener('keydown', (e) => { 
        if (e.key === 'Escape') { 
          closeModal(); 
          closeEditModal(); 
          closeAboutModal();
        } 
      });
    }

    // START
    checkLicense();
  </script>
</body>
</html>
